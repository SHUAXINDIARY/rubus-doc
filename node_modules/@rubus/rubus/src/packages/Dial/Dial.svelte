<script>
  import { onMount } from "svelte";

  /**
   * Set the value of dial input
   * @type { number }[value = 0]
   */
  export let value = 0;

  /**
   * Set the drag damping of dial input
   * @type { number }[damping = 0.8]
   */
  export let damping = 0.8;

  /**
   * Set to `true` to disable the dial input
   * @type {boolean}[disabled=false]
   */
  export let disabled = false;

  /**
   * Specify the small mode of dial input
   * @type { boolean } [isSmall= false]
   */
  export let isSmall = false;

  let dial;
  let i = 0;
  $: deg = (value * 2.7 - 45).toFixed(2);

  onMount(() => {
    i = +value;
    !disabled &&
      dial.addEventListener("mousedown", function (e) {
        startGetDialValue(e);
      });
  });

  function startGetDialValue(e) {
    getDialValue(e);
    window.addEventListener("mousemove", getDialValue);
    window.addEventListener("mouseup", endGetDialValue);
  }

  function getDialValue(e) {
    e.preventDefault();
    const thisRect = dial.getBoundingClientRect();
    let x = e.pageX - thisRect.left;
    let y = e.pageY - thisRect.top;

    x > 0 && y > 0 ? (i = i + damping) : (i = i - damping);

    if (i > 100) {
      value = 100;
      i = value;
    } else if (i < 0) {
      value = 0;
      i = value;
    } else {
      value = +i.toFixed(2);
      i = value;
    }
  }

  function endGetDialValue(e) {
    window.removeEventListener("mousemove", getDialValue);
  }
</script>

<div class="spectrum-Dial" class:is-disabled={disabled} class:spectrum-Dial--small={isSmall} bind:this={dial}>
  <div class="spectrum-Dial-controls">
    <div class="spectrum-Dial-handle" tabindex="0" style="transform: rotate({deg}deg);">
      <input type="range" class="spectrum-Dial-input" min="0" max="100" {value} />
    </div>
  </div>
</div>
