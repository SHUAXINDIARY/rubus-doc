<script>
  import { current_component } from "svelte/internal";
  import { getEventsAction } from "../utils/get-events-action.js";
  /**
   * Specify the current index for the tabs
   * @type {number} [currentTabIndex = 0]
   */
  export let currentTabIndex = 0;

  /**
   * Specify the unique index for the tab
   * @type {number} [tselfIndex = 0]
   */
  export let selfIndex = 0;

  /**
   * Whether to automatically change the index value
   * @type {boolean} [tabAutoSwitch = true]
   */
  export let tabAutoSwitch = true;

  /**
   * Set to `true` to disable the tab
   * @type {boolean} [disabled=false]
   */
  export let disabled = false;

  /**
   * Preconditions: disabled === true
   * Cursor not-allowed when the tab is disabled
   * @type { boolean }  [notAllowed= false]
   */
  export let notAllowed = false;

  /**
   * Set the `href` to use an anchor link
   * @type {string} [href = ""]
   */
  export let href = "";

  /**
   * Preconditions: href
   * Where to display the linked URL
   * @type {"_self" | "_blank" | "_parent" | "_top"} [target = ""]
   */
  export let target = "";

  const eventsListen = getEventsAction(current_component);
  function switchTab() {
    if (tabAutoSwitch && !disabled) {
      return (currentTabIndex = selfIndex);
    }
  }

  function handleKeydown(e) {
    let _e = event ? window.event : e;
    if (_e.keyCode == 13 || _e.keyCode == 32) {
      switchTab();
    }
  }
</script>

<style global>
  .spectrum-Tabs-item-disabled {
    pointer-events: none;
    color: var(--spectrum-button-secondary-text-color-disabled, var(--spectrum-global-color-gray-500));
  }
  .spectrum-Tabs-item-disabled .spectrum-Icon {
    color: var(--spectrum-button-secondary-text-color-disabled, var(--spectrum-global-color-gray-500)) !important;
  }
  .spectrum-Tabs-item-disabled:hover {
    color: var(--spectrum-button-secondary-text-color-disabled, var(--spectrum-global-color-gray-500));
  }
  .spectrum-Tabs-item-disabled:active {
    color: var(--spectrum-button-secondary-text-color-disabled, var(--spectrum-global-color-gray-500));
  }
  .spectrum-Tabs-item-disabled .spectrum-Tabs-itemLabel {
    pointer-events: none;
    color: var(--spectrum-button-secondary-text-color-disabled, var(--spectrum-global-color-gray-500));
  }
  .spectrum-Tabs-item-disabled .spectrum-Tabs-itemLabel:hover {
    color: var(--spectrum-button-secondary-text-color-disabled, var(--spectrum-global-color-gray-500));
  }
  .spectrum-Tabs-item-disabled .spectrum-Tabs-itemLabel:active {
    color: var(--spectrum-button-secondary-text-color-disabled, var(--spectrum-global-color-gray-500));
  }
</style>

{#if href}
  <a
    {href}
    {target}
    {...$$restProps}
    class="spectrum-Tabs-item {disabled && notAllowed ? 'not-allowed' : ''}"
    class:spectrum-Tabs-item-disabled={disabled}
    class:is-selected={+selfIndex === +currentTabIndex}
    tabindex="0"
    on:click={switchTab}
    on:keydown={handleKeydown}
    use:eventsListen>
    <slot name="tab-icon" />
    <span class="spectrum-Tabs-itemLabel">
      <slot />
    </span>
  </a>
{:else}
  <div
    {...$$restProps}
    class="spectrum-Tabs-item {disabled && notAllowed ? 'not-allowed' : ''}"
    class:spectrum-Tabs-item-disabled={disabled}
    class:is-selected={+selfIndex === +currentTabIndex}
    tabindex="0"
    on:click={switchTab}
    on:keydown={handleKeydown}
    use:eventsListen>
    <slot name="tab-icon" />
    <span class="spectrum-Tabs-itemLabel">
      <slot />
    </span>
  </div>
{/if}
