<script>
  import { onMount } from "svelte";

  /**
   * Whether the CycleButton  is currently active
   * @type {boolean}[isSelected = false]
   */
  export let isSelected = false;

  let cycleButton;
  onMount(() => {
    if (cycleButton.children.length) {
      if (cycleButton.children[0]) {
        cycleButton.children[0].classList.add("sspectrum-Icon--sizeS");
        cycleButton.children[0].classList.add("spectrum-CycleButton-item");
        !isSelected && cycleButton.children[0].classList.add("is-selected");
      }
      if (cycleButton.children[1]) {
        cycleButton.children[1].classList.add("sspectrum-Icon--sizeS");
        cycleButton.children[1].classList.add("spectrum-CycleButton-item");
        isSelected && cycleButton.children[1].classList.add("is-selected");
      }
    }
  });

  function switchStatus(event) {
    var button = event.target.closest(".spectrum-CycleButton");
    if (button) {
      var icons = button.querySelectorAll(".spectrum-Icon");
      var currentIcon = button.querySelector(".spectrum-Icon.is-selected");
      var currentIconIndex = Array.prototype.slice.call(icons).indexOf(currentIcon);
      if (currentIcon) {
        currentIcon.classList.remove("is-selected");

        var newIndex = currentIconIndex + 1 < icons.length ? currentIconIndex + 1 : 0;
        icons[newIndex].classList.add("is-selected");
      }
    }
  }
</script>

<button
  class="spectrum-ActionButton spectrum-ActionButton--quiet spectrum-CycleButton"
  bind:this={cycleButton}
  on:click={switchStatus}
  on:click
  on:keydown
  on:keyup
  on:keypress
  on:dblclick>
  <slot />
</button>
