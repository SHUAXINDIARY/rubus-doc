<script>
  import Button from "../Button";
  import TextField from "../TextField";
  import { IconMagnifier, IconCrossSmall } from "@rubus/svelte-spectrum-icons-ui";

  /**
   * The element's unique identifier.
   * @type { string }[id = `search-${Math.round(Math.random() * (99999 - 0)) + 0}`]
   */
  export let id = `search-${Math.round(Math.random() * (99999 - 0)) + 0}`;

  /**
   * Temporary text that occupies the text input when it is empty.
   * @type { string }[placeholder = "Search"]
   */
  export let placeholder = "Search";

  /**
   * The name of the input element, used when submitting an HTML form.
   * @type { string }[name = "search"]
   */
  export let name = "search";

  /**
   * The name of the input element, used when submitting an HTML form.
   * @type { string }[name = "field"]
   */
  export let value = "";

  /**
   * Set to `true` to disable the search input
   * @type {boolean} [disabled=false]
   */
  export let disabled = false;

  /**
   * Whether the search should be displayed with a quiet style.
   * @type {boolean} [isQuiet=false]
   */
  export let isQuiet = false;

  /**
   * Used to specify the autocomplete attribute of the input element
   * @type { string }[autocomplete = "off"]
   */
  export let autocomplete = "off";

  let focused = false;
  $: showClearButton = (focused && value) || value;
</script>

<form class="spectrum-Search" class:spectrum-Search--quiet={isQuiet} class:is-disabled={disabled} {id}>
  <TextField
    bind:value
    resetType="search"
    {placeholder}
    {name}
    {disabled}
    {isQuiet}
    {autocomplete}
    on:focusin={() => {
      focused = true;
    }}
    on:focusout={() => {
      focused = false;
    }}
    on:focusin
    on:focusout
    on:input
    on:change
    on:keyup
    on:keydown
    inputClass="spectrum-Search-input">
    <IconMagnifier focusable="false" aria-hidden="true" />
  </TextField>

  {#if showClearButton}
    <Button type="reset" exterior="clear" class="spectrum-Search-clearButton" {disabled}>
      <IconCrossSmall className="spectrum-Icon spectrum-UIIcon-CrossSmall" focusable="false" aria-hidden="true" />
    </Button>
  {/if}
</form>
