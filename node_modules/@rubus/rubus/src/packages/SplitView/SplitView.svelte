<script>
  import { onMount } from "svelte";

  /**
   * Specify the draggable status for the SplitView
   * @type { boolean }  [isDraggable = false]
   */
  export let isDraggable = false;

  /**
   * Specify the orientation  for the SplitView
   * @type {"horizontal" | "vertical"}  [orientation = "horizontal"]
   */
  export let orientation = "horizontal";

  /**
   * Specify the height for the SplitView
   * @type { DimensionValue }  [height = "size-3000"]
   */
  export let height = "size-3000";

  /**
   * Specify the width for the SplitView
   * @type { DimensionValue }  [width = "size-6000"]
   */
  export let width = "size-6000";

  /**
   * Specify the dimension for the first pane
   * @type { number }  [paneDimension = 50]
   */
  export let paneDimension = 50;

  /**
   * Specify the dimension for the another pane
   * @type { number }  [paneAnotherDimension = 50]
   */
  export let paneAnotherDimension = 50;

  let splitViewEl;
  let splitterEl;
  onMount(() => {
    splitterEl.addEventListener("mousedown", function (e) {
      handleSplitViewAction(e);
    });
  });

  function handleSplitViewAction(e) {
    if (!isDraggable) {
      return;
    }
    getSplitViewPosition(e);
    window.addEventListener("mousemove", getSplitViewPosition);
    window.addEventListener("mouseup", removeGetSplitViewPositionEvent);
  }

  function getSplitViewPosition(e) {
    e.preventDefault();

    const thisRect = splitViewEl.getBoundingClientRect();
    let _pageP = orientation === "horizontal" ? e.pageX : e.pageY;
    let _orientation = orientation === "horizontal" ? thisRect.left : thisRect.top;
    let _crisscross = orientation === "horizontal" ? thisRect.width : thisRect.height;

    let _p = _pageP - _orientation;
    if (_p > _crisscross) {
      _p = _crisscross;
    }
    if (_p < 0) {
      _p = 0;
    }

    paneDimension = (_p / _crisscross) * 100;
    paneAnotherDimension = 100 - paneDimension;
  }

  function removeGetSplitViewPositionEvent(e) {
    window.removeEventListener("mousemove", getSplitViewPosition);
  }

  $: styleCssText = [
    height && height.toString().indexOf("size") !== -1
      ? `height:var(--spectrum-global-dimension-${height});`
      : height.toString().indexOf("%") !== -1
      ? `height: ${height};`
      : `height: ${height}px;`,
    width && width.toString().indexOf("size") !== -1
      ? `width:var(--spectrum-global-dimension-${width});`
      : width.toString().indexOf("%") !== -1
      ? `width: ${width};`
      : `width: ${width}px;`,
  ]
    .filter(Boolean)
    .join(" ");
</script>

<style global>
  .spectrum-SplitView-splitter.is-draggable:hover {
    cursor: grab;
  }
  .spectrum-SplitView--horizontal > .spectrum-SplitView-splitter.is-draggable:active {
    cursor: ew-resize;
  }
  .spectrum-SplitView--vertical > .spectrum-SplitView-splitter.is-draggable:active {
    cursor: ns-resize;
  }
</style>

<div class="spectrum-SplitView spectrum-SplitView--{orientation}" style={styleCssText} bind:this={splitViewEl}>
  <div
    class="spectrum-SplitView-pane"
    style={orientation === 'horizontal' ? `width: ${paneDimension}%;` : `height: ${paneDimension}%;`}>
    <slot />
  </div>
  <div
    class="spectrum-SplitView-splitter "
    class:is-draggable={isDraggable}
    class:is-collapsed-start={paneDimension === 0}
    class:is-collapsed-end={paneAnotherDimension <= 0}
    bind:this={splitterEl}>
    {#if isDraggable}
      <div class="spectrum-SplitView-gripper" />
    {/if}
  </div>
  <div
    class="spectrum-SplitView-pane"
    style={orientation === 'horizontal' ? `width: ${paneAnotherDimension}%;` : `height: ${paneAnotherDimension}%;`}>
    <slot name="splitview-pane-another" />
  </div>
</div>
