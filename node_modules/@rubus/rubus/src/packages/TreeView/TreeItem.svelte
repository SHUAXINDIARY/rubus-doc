<script>
  import { IconChevronRightMedium } from "@rubus/svelte-spectrum-icons-ui";
  import { IconFolder, IconDocument } from "@rubus/svelte-spectrum-icons-workflow";
  import { getContext, onMount } from "svelte";
  import { advanceAddClassName } from "../utils/presetStyle.js";
  import Thumbnail from "../Thumbnail";

  /**
   *  Specify the label text for the TreeView item
   * @type {string} [label = ""]
   */
  export let label = "Label";

  /**
   *  Specify the open status for the TreeView item
   * @type {boolean} [isOpen = false]
   */
  export let isOpen = false;

  /**
   * Whether the item can be used as the target of the drop event
   * @type {boolean} [isDropTarget = false]
   */
  export let isDropTarget = false;

  /**
   * Whether to enable custom icon
   * @type {boolean} [customIcon = false]
   */
  export let customIcon = false;

  /**
   * Set the background-color style of the thumbnail element
   * @type {string} [backgroundColor = ""]
   */
  export let thumbnailBackgroundColor = "";

  /**
   * Set the src attribute of the thumbnail img element
   * @type {string} [imgUrl = ""]
   */
  export let thumbnailImgUrl = "";

  /**
   * Set the alt attribute of the thumbnail img element
   * @type {string} [imgAlt = "Asset image"]
   */
  export let thumbnailImgAlt = "Image";

  let rubusTreeViewConfig = getContext("rubusTreeViewConfig");
  let hasChild = false;
  let treeViewItemEl;
  let treeViewItemLinkEl;
  onMount(() => {
    if (treeViewItemEl.childNodes.length > 2 && treeViewItemEl.childNodes[2].classList) {
      hasChild = treeViewItemEl.childNodes[2].classList.contains("spectrum-TreeView");
    }
    customIcon &&
      treeViewItemLinkEl &&
      advanceAddClassName(treeViewItemLinkEl, "treeview-icon", "spectrum-TreeView-itemIcon");
  });

  function cutoverStatus() {
    isOpen = !isOpen;
  }
</script>

<li
  class="spectrum-TreeView-item"
  class:is-open={isOpen}
  class:is-drop-target={isDropTarget}
  bind:this={treeViewItemEl}>
  <a class="spectrum-TreeView-itemLink" href="#all" on:click={cutoverStatus} bind:this={treeViewItemLinkEl}>
    <slot name="treeview-icon" />
    {#if rubusTreeViewConfig.resourceExplorer && hasChild && !customIcon}
      <IconFolder className="spectrum-TreeView-itemIcon" focusable="false" aria-hidden="true" />
    {:else if rubusTreeViewConfig.resourceExplorer && !customIcon}
      <IconDocument className="spectrum-TreeView-itemIcon" focusable="false" aria-hidden="true" />
    {:else if hasChild && !customIcon}
      <IconChevronRightMedium className="spectrum-TreeView-itemIndicator" focusable="false" aria-hidden="true" />
    {/if}
    {#if rubusTreeViewConfig.hasThumbnail}
      <Thumbnail
        class="spectrum-TreeView-itemThumbnail"
        imgAlt={thumbnailImgAlt}
        imgUrl={thumbnailImgUrl}
        backgroundColor={thumbnailBackgroundColor} />
    {/if}
    <span class="spectrum-TreeView-itemLabel">{label}</span></a>
  <slot />
</li>
