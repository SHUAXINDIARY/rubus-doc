<script>
  import { afterUpdate, onMount } from "svelte";
  import { getRect } from "../utils/element.js";

  /**
   * Set whether popover is open
   * @type {boolean}[isOpen=false]
   */
  export let isOpen = false;

  /**
   * Specify the  variants of popver
   * @type {"menu"|"dialog"}[variants = "menu"]
   */
  export let variants = "menu";

  /**
   * Specify the  position mode of popver
   * variants => "menu" @type { "auto"|"topLeft"|"topRight"|"bottomLeft"|"bottomRight""leftTop"|"rightTop"|"leftBottom"|"rightBottom"} [ popverPosition = "auto"]
   * variants => "dialog" @type { "centerLeft"|"centerRight"|"centerTop"|"centerBottom" }
   */
  export let popverPosition = "auto";

  /**
   * Specify the  quite mode of popver
   * @type {boolean}[isOpen=false]
   */
  export let isQuiet = false;

  /**
   * Specify the  title of popver
   * @type {string}[title = "Popover Title"]
   */
  export let title = "Popover Title";

  let popverPositionAuto = "bottomRight";

  let popover;
  let popoverTip;
  let menuButton;
  let menuButtonWidth;
  let menuButtonHeight;
  let popoverWidth;
  let popoverHeight;
  let popoverTipWidth;
  let popoverTipHeight;

  onMount(() => {
    setCssVar();
  });
  afterUpdate(() => {
    autoPlace();
  });

  function setCssVar() {
    if (!popover.parentElement.querySelector("#rubus-ActionSource")) {
      return;
    }
    menuButton = getRect(popover.parentElement.querySelector("#rubus-ActionSource"));
    menuButtonWidth = menuButton && menuButton.width;
    menuButtonHeight = menuButton && menuButton.height;
    popoverWidth = popover && popover.offsetWidth;
    popoverHeight = popover && popover.offsetHeight;
    popoverTipWidth = popoverTip && popoverTip.offsetWidth;
    popoverTipHeight = popoverTip && popoverTip.offsetHeight;

    popover.parentElement.style.setProperty("--rubus-action-menu-button-width", menuButtonWidth + `px`);
    popover.parentElement.style.setProperty("--rubus-action-menu-button-height", menuButtonHeight + `px`);
    popover.parentElement.style.setProperty("--rubus-action-menu-popover-width", popoverWidth + `px`);
    popover.parentElement.style.setProperty("--rubus-action-menu-popover-height", popoverHeight + `px`);
    popover.parentElement.style.setProperty("--rubus-action-menu-popover-tip-width", popoverTipWidth + `px`);
    popover.parentElement.style.setProperty("--rubus-action-menu-popover-tip-height", popoverTipHeight + `px`);
  }

  function autoPlace() {
    if (variants == "menu") {
      switch (popverPosition == "auto") {
        case menuButton.x > popoverWidth &&
          menuButton.y > popoverHeight &&
          menuButton.right < popoverWidth &&
          menuButton.bottom < popoverHeight:
          popverPositionAuto = "topLeft";
          break;
        case menuButton.x < popoverWidth &&
          menuButton.y > popoverHeight &&
          menuButton.right > popoverWidth &&
          menuButton.bottom < popoverHeight:
          popverPositionAuto = "topRight";
          break;
        case menuButton.right < popoverWidth && menuButton.x > popoverWidth:
          popverPositionAuto = "bottomLeft";
          break;
        default:
          popverPositionAuto = "bottomRight";
      }
    }
    if (variants == "dialog") {
      switch (popverPosition == "auto") {
        case menuButton.x > popoverWidth && menuButton.right < popoverWidth:
          popverPositionAuto = "centerLeft";
          break;
        case menuButton.x < popoverWidth && menuButton.right > popoverWidth:
          popverPositionAuto = "centerRight";
          break;
        case menuButton.x > popoverWidth &&
          menuButton.y > popoverHeight &&
          menuButton.right > popoverWidth &&
          menuButton.bottom < popoverHeight:
          popverPositionAuto = "centerTop";
          break;
        default:
          popverPositionAuto = "centerBottom";
      }
    }
  }
</script>

<style global>
  .rubus-Popover-registering {
    height: var(--spectrum-global-dimension-size-75);
  }
  .spectrum-Popover {
    background-color: var(--spectrum-popover-background-color, var(--spectrum-global-color-gray-50));
    border-color: var(--spectrum-popover-border-color, var(--spectrum-alias-border-color-dark));
    box-shadow: 0 1px 4px var(--spectrum-popover-shadow-color, var(--spectrum-alias-dropshadow-color));
  }
  .spectrum-Popover {
    z-index: 100;
  }
  .spectrum-Popover {
    visibility: hidden;

    opacity: 0;

    transition: transform var(--spectrum-global-animation-duration-100, 130ms) ease-in-out,
      opacity var(--spectrum-global-animation-duration-100, 130ms) ease-in-out,
      visibility 0ms linear var(--spectrum-global-animation-duration-100, 130ms);

    pointer-events: none;
  }

  .spectrum-Popover.is-open {
    visibility: visible;

    opacity: 1;

    transition-delay: 0ms;

    pointer-events: auto;
  }
  .spectrum-Popover {
    display: -ms-inline-flexbox;
    display: inline-flex;
    -ms-flex-direction: column;
    flex-direction: column;
    box-sizing: border-box;

    min-width: var(--spectrum-global-dimension-size-400);
    min-height: var(--spectrum-global-dimension-size-400);

    position: absolute;

    border-style: solid;
    border-width: var(--spectrum-popover-border-size, var(--spectrum-alias-border-size-thin));
    border-radius: var(--spectrum-popover-border-radius, var(--spectrum-alias-border-radius-regular));

    outline: none;
  }

  .spectrum-Popover-tip {
    position: absolute;
    overflow: hidden;
    width: calc(var(--spectrum-popover-tip-width, var(--spectrum-global-dimension-size-250)) + 1px);
    height: calc(
      var(--spectrum-popover-tip-width, var(--spectrum-global-dimension-size-250)) / 2 +
        var(--spectrum-popover-border-size, var(--spectrum-alias-border-size-thin))
    );
  }
  .spectrum-Popover-tip {
    position: absolute;
    overflow: hidden;
    width: calc(var(--spectrum-popover-tip-width, var(--spectrum-global-dimension-size-250)) + 1px);
    height: calc(
      var(--spectrum-popover-tip-width, var(--spectrum-global-dimension-size-250)) / 2 +
        var(--spectrum-popover-border-size, var(--spectrum-alias-border-size-thin))
    );
  }
  .spectrum-Popover-tip::after {
    content: "";
    width: var(--spectrum-popover-tip-width, var(--spectrum-global-dimension-size-250));
    height: var(--spectrum-popover-tip-width, var(--spectrum-global-dimension-size-250));
    border-width: var(--spectrum-popover-border-size, var(--spectrum-alias-border-size-thin));
    border-style: solid;
    position: absolute;
    transform: rotate(45deg);
    top: -18px;
  }

  .spectrum-Popover--dialog {
    min-width: 270px;
    padding: 30px 29px;
  }
  .spectrum-Popover .spectrum-Dialog-header,
  .spectrum-Popover .spectrum-Dialog-footer,
  .spectrum-Popover .spectrum-Dialog-wrapper {
    background-color: transparent;
  }

  .spectrum-Popover .spectrum-Popover-tip::after {
    background-color: var(--spectrum-popover-background-color, var(--spectrum-global-color-gray-50));
    border-color: var(--spectrum-popover-border-color, var(--spectrum-alias-border-color-dark));
    box-shadow: -1px -1px 4px var(--spectrum-popover-shadow-color, var(--spectrum-alias-dropshadow-color));
  }

  .rubus-Popover--bottomRight {
    transform: translate(0, calc(-0.8 * var(--rubus-action-menu-button-height)));
  }
  .rubus-Popover-quiet--bottomRight {
    transform: translate(
      calc(-1 * var(--spectrum-global-dimension-size-125)),
      calc(-0.8 * var(--rubus-action-menu-button-height))
    );
  }
  .rubus-Popover--bottomRight.is-open {
    transform: translate(0, 0);
  }
  .rubus-Popover-quiet--bottomRight.is-open {
    transform: translate(calc(-1 * var(--spectrum-global-dimension-size-125)), 0);
  }
  .rubus-Popover--bottomLeft {
    transform: translate(
      calc(-1 * var(--rubus-action-menu-popover-width) + var(--rubus-action-menu-button-width)),
      calc(-0.8 * var(--rubus-action-menu-button-height))
    );
  }
  .rubus-Popover--bottomLeft.is-open {
    transform: translate(calc(-1 * var(--rubus-action-menu-popover-width) + var(--rubus-action-menu-button-width)), 0);
  }
  .rubus-Popover-quiet--bottomLeft {
    transform: translate(
      calc(
        -1 * var(--rubus-action-menu-popover-width) + var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-125)
      ),
      calc(-0.8 * var(--rubus-action-menu-button-height))
    );
  }
  .rubus-Popover-quiet--bottomLeft.is-open {
    transform: translate(
      calc(
        -1 * var(--rubus-action-menu-popover-width) + var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-125)
      ),
      0
    );
  }

  .rubus-Popover--topLeft {
    transform: translate(
      calc(-1 * var(--rubus-action-menu-popover-width) + var(--rubus-action-menu-button-width)),
      calc(
        -0.8 * (var(--rubus-action-menu-button-height) + var(--rubus-action-menu-popover-height) +
              var(--spectrum-dropdown-flyout-menu-offset-y, var(--spectrum-global-dimension-size-75)))
      )
    );
  }
  .rubus-Popover--topLeft.is-open {
    transform: translate(
      calc(-1 * var(--rubus-action-menu-popover-width) + var(--rubus-action-menu-button-width)),
      calc(
        -1 * (var(--rubus-action-menu-button-height) + var(--rubus-action-menu-popover-height) +
              var(--spectrum-global-dimension-size-75) * 2)
      )
    );
  }
  .rubus-Popover-quiet--topLeft {
    transform: translate(
      calc(
        -1 * var(--rubus-action-menu-popover-width) + var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-125)
      ),
      calc(
        -0.8 * (var(--rubus-action-menu-button-height) + var(--rubus-action-menu-popover-height) +
              var(--spectrum-dropdown-flyout-menu-offset-y, var(--spectrum-global-dimension-size-75)))
      )
    );
  }

  .rubus-Popover-quiet--topLeft.is-open {
    transform: translate(
      calc(
        -1 * var(--rubus-action-menu-popover-width) + var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-125)
      ),
      calc(
        -1 * (var(--rubus-action-menu-button-height) + var(--rubus-action-menu-popover-height) +
              var(--spectrum-global-dimension-size-75) * 2)
      )
    );
  }
  .rubus-Popover--topRight {
    transform: translate(
      0,
      calc(
        -0.8 * (var(--rubus-action-menu-button-height) + var(--rubus-action-menu-popover-height) +
              var(--spectrum-dropdown-flyout-menu-offset-y, var(--spectrum-global-dimension-size-75)))
      )
    );
  }

  .rubus-Popover--topRight.is-open {
    transform: translate(
      0,
      calc(
        -1 * (var(--rubus-action-menu-button-height) + var(--rubus-action-menu-popover-height) +
              var(--spectrum-global-dimension-size-75) * 2)
      )
    );
  }
  .rubus-Popover-quiet--topRight {
    transform: translate(
      calc(-1 * var(--spectrum-global-dimension-size-125)),
      calc(
        -0.8 * (var(--rubus-action-menu-button-height) + var(--rubus-action-menu-popover-height) +
              var(--spectrum-dropdown-flyout-menu-offset-y, var(--spectrum-global-dimension-size-75)))
      )
    );
  }
  .rubus-Popover-quiet--topRight.is-open {
    transform: translate(
      calc(-1 * var(--spectrum-global-dimension-size-125)),
      calc(
        -1 * (var(--rubus-action-menu-button-height) + var(--rubus-action-menu-popover-height) +
              var(--spectrum-global-dimension-size-75) * 2)
      )
    );
  }
  .rubus-Popover--leftTop {
    transform: translate(
      calc(-0.8 * (var(--rubus-action-menu-popover-width) + var(--spectrum-global-dimension-size-75))),
      calc(-1 * var(--rubus-action-menu-popover-height) - var(--spectrum-global-dimension-size-75))
    );
  }
  .rubus-Popover-quiet--leftTop {
    transform: translate(
      calc(-0.8 * (var(--rubus-action-menu-popover-width) + var(--spectrum-global-dimension-size-75))),
      calc(
        -1 * var(--rubus-action-menu-popover-height) - var(--spectrum-global-dimension-size-75) + var(--spectrum-global-dimension-size-50)
      )
    );
  }
  .rubus-Popover--leftTop.is-open {
    transform: translate(
      calc(-1 * (var(--rubus-action-menu-popover-width) + var(--spectrum-global-dimension-size-75))),
      calc(-1 * var(--rubus-action-menu-popover-height) - var(--spectrum-global-dimension-size-75))
    );
  }
  .rubus-Popover-quiet--leftTop.is-open {
    transform: translate(
      calc(-1 * (var(--rubus-action-menu-popover-width) + var(--spectrum-global-dimension-size-75))),
      calc(
        -1 * var(--rubus-action-menu-popover-height) - var(--spectrum-global-dimension-size-75) + var(--spectrum-global-dimension-size-50)
      )
    );
  }
  .rubus-Popover--rightTop {
    transform: translate(
      calc(0.8 * (var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-75))),
      calc(-1 * var(--rubus-action-menu-popover-height) - var(--spectrum-global-dimension-size-75))
    );
  }
  .rubus-Popover--rightTop.is-open {
    transform: translate(
      calc(1 * (var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-75))),
      calc(-1 * var(--rubus-action-menu-popover-height) - var(--spectrum-global-dimension-size-75))
    );
  }
  .rubus-Popover-quiet--rightTop {
    transform: translate(
      calc(0.8 * (var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-75))),
      calc(
        -1 * var(--rubus-action-menu-popover-height) - var(--spectrum-global-dimension-size-75) + var(--spectrum-global-dimension-size-50)
      )
    );
  }
  .rubus-Popover-quiet--rightTop.is-open {
    transform: translate(
      calc(1 * (var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-75))),
      calc(
        -1 * var(--rubus-action-menu-popover-height) - var(--spectrum-global-dimension-size-75) + var(--spectrum-global-dimension-size-50)
      )
    );
  }
  .rubus-Popover--rightBottom {
    transform: translate(
      calc(0.8 * (var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-75))),
      calc(-1 * var(--rubus-action-menu-button-height) - var(--spectrum-global-dimension-size-75))
    );
  }
  .rubus-Popover--rightBottom.is-open {
    transform: translate(
      calc(1 * (var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-75))),
      calc(-1 * var(--rubus-action-menu-button-height) - var(--spectrum-global-dimension-size-75))
    );
  }
  .rubus-Popover-quiet--rightBottom {
    transform: translate(
      calc(0.8 * (var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-75))),
      calc(
        -1 * var(--rubus-action-menu-button-height) - var(--spectrum-global-dimension-size-75) - var(--spectrum-global-dimension-size-50)
      )
    );
  }
  .rubus-Popover-quiet--rightBottom.is-open {
    transform: translate(
      calc(1 * (var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-75))),
      calc(
        -1 * var(--rubus-action-menu-button-height) - var(--spectrum-global-dimension-size-75) - var(--spectrum-global-dimension-size-50)
      )
    );
  }
  .rubus-Popover--leftBottom {
    transform: translate(
      calc(-0.8 * (var(--rubus-action-menu-popover-width) + var(--spectrum-global-dimension-size-75))),
      calc(-1 * var(--rubus-action-menu-button-height) - var(--spectrum-global-dimension-size-75))
    );
  }
  .rubus-Popover-quiet--leftBottom {
    transform: translate(
      calc(-0.8 * (var(--rubus-action-menu-popover-width) + var(--spectrum-global-dimension-size-75))),
      calc(
        -1 * var(--rubus-action-menu-button-height) - var(--spectrum-global-dimension-size-75) - var(--spectrum-global-dimension-size-50)
      )
    );
  }
  .rubus-Popover--leftBottom.is-open {
    transform: translate(
      calc(-1 * (var(--rubus-action-menu-popover-width) + var(--spectrum-global-dimension-size-75))),
      calc(-1 * var(--rubus-action-menu-button-height) - var(--spectrum-global-dimension-size-75))
    );
  }
  .rubus-Popover-quiet--leftBottom.is-open {
    transform: translate(
      calc(-1 * (var(--rubus-action-menu-popover-width) + var(--spectrum-global-dimension-size-75))),
      calc(
        -1 * var(--rubus-action-menu-button-height) - var(--spectrum-global-dimension-size-75) - var(--spectrum-global-dimension-size-50)
      )
    );
  }

  .rubus-Popover--centerBottom {
    transform: translate(
      calc(-1 * var(--rubus-action-menu-popover-width) / 2 + var(--rubus-action-menu-button-width) / 2),
      calc(-1 * var(--spectrum-global-dimension-size-75))
    );
  }
  .rubus-Popover--centerBottom.is-open {
    transform: translate(
      calc(-1 * var(--rubus-action-menu-popover-width) / 2 + var(--rubus-action-menu-button-width) / 2),
      var(--spectrum-global-dimension-size-75)
    );
  }
  .spectrum--large .rubus-Popover--centerBottom.is-open {
    transform: translate(
      calc(-1 * var(--rubus-action-menu-popover-width) / 2 + var(--rubus-action-menu-button-width) / 2),
      var(--spectrum-global-dimension-size-125)
    );
  }
  .spectrum--medium .rubus-Popover--centerBottom .spectrum-Popover-tip {
    top: calc(-0.961 * var(--spectrum-global-dimension-size-130));
  }
  .spectrum--large .rubus-Popover--centerBottom .spectrum-Popover-tip {
    top: calc(-1 * var(--spectrum-global-dimension-size-125));
  }
  .rubus-Popover--centerBottom .spectrum-Popover-tip {
    left: calc((var(--rubus-action-menu-popover-width) - var(--rubus-action-menu-popover-tip-width)) / 2);

    transform: rotate(180deg);
  }
  .rubus-Popover--centerTop {
    transform: translate(
      calc(-1 * var(--rubus-action-menu-popover-width) / 2 + var(--rubus-action-menu-button-width) / 2),
      calc(
        -0.8 * (var(--rubus-action-menu-popover-height) + var(--rubus-action-menu-button-height) +
              var(--rubus-action-menu-popover-tip-height) + (var(--spectrum-global-dimension-size-75)))
      )
    );
  }
  .spectrum--medium .rubus-Popover--centerTop.is-open {
    transform: translate(
      calc(-1 * var(--rubus-action-menu-popover-width) / 2 + var(--rubus-action-menu-button-width) / 2),
      calc(
        -1 * (var(--rubus-action-menu-popover-height) + var(--rubus-action-menu-button-height) +
              var(--rubus-action-menu-popover-tip-height) + (var(--spectrum-global-dimension-size-75)))
      )
    );
  }
  .spectrum--large .rubus-Popover--centerTop.is-open {
    transform: translate(
      calc(-1 * var(--rubus-action-menu-popover-width) / 2 + var(--rubus-action-menu-button-width) / 2),
      calc(
        -1 * (var(--rubus-action-menu-popover-height) + var(--rubus-action-menu-button-height) +
              var(--rubus-action-menu-popover-tip-height) + var(--spectrum-global-dimension-size-175))
      )
    );
  }
  .spectrum--medium .rubus-Popover--centerTop .spectrum-Popover-tip {
    bottom: calc(-0.961 * var(--spectrum-global-dimension-size-130));
  }
  .spectrum--large .rubus-Popover--centerTop .spectrum-Popover-tip {
    bottom: calc(-1 * var(--spectrum-global-dimension-size-125));
  }
  .rubus-Popover--centerTop .spectrum-Popover-tip {
    left: calc((var(--rubus-action-menu-popover-width) - var(--rubus-action-menu-popover-tip-width)) / 2);

    transform: rotate(0);
  }
  .rubus-Popover--centerLeft {
    transform: translate(
      calc(-0.8 * (var(--rubus-action-menu-popover-width) + var(--spectrum-global-dimension-size-75) * 2)),
      calc(
        -1 * ((
                var(--rubus-action-menu-popover-height) + var(--rubus-action-menu-button-height) +
                  var(--rubus-action-menu-popover-tip-height)
              ) / 2)
      )
    );
  }
  .spectrum--medium .rubus-Popover--centerLeft.is-open {
    transform: translate(
      calc(-1 * (var(--rubus-action-menu-popover-width) + var(--spectrum-global-dimension-size-75) * 2)),
      calc(
        -1 * ((
                var(--rubus-action-menu-popover-height) + var(--rubus-action-menu-button-height) +
                  var(--rubus-action-menu-popover-tip-height)
              ) / 2)
      )
    );
  }
  .spectrum--large .rubus-Popover--centerLeft.is-open {
    transform: translate(
      calc(-1 * (var(--rubus-action-menu-popover-width) + var(--spectrum-global-dimension-size-115) * 2)),
      calc(
        -1 * ((
                var(--rubus-action-menu-popover-height) + var(--rubus-action-menu-button-height) +
                  var(--rubus-action-menu-popover-tip-height)
              ) / 1.9)
      )
    );
  }

  .spectrum--medium .rubus-Popover--centerLeft .spectrum-Popover-tip {
    top: calc((var(--rubus-action-menu-popover-height) - var(--rubus-action-menu-popover-tip-height)) / 2);
    right: calc(-0.99 * var(--spectrum-global-dimension-size-200));
    transform: rotate(-90deg);
  }
  .spectrum--large .rubus-Popover--centerLeft .spectrum-Popover-tip {
    top: calc((var(--rubus-action-menu-popover-height) - var(--rubus-action-menu-popover-tip-height)) / 2);
    right: calc(-0.972 * var(--spectrum-global-dimension-size-200));
    transform: rotate(-90deg);
  }
  .rubus-Popover--centerRight {
    transform: translate(
      calc(
        0.8 * var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-75) +
          var(--rubus-action-menu-popover-tip-width) / 3
      ),
      calc(
        -1 * ((
                var(--rubus-action-menu-popover-height) + var(--rubus-action-menu-button-height) +
                  var(--rubus-action-menu-popover-tip-height)
              ) / 2)
      )
    );
  }
  .spectrum--medium .rubus-Popover--centerRight.is-open {
    transform: translate(
      calc(
        var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-75) +
          var(--rubus-action-menu-popover-tip-width) / 3
      ),
      calc(
        -1 * ((
                var(--rubus-action-menu-popover-height) + var(--rubus-action-menu-button-height) +
                  var(--rubus-action-menu-popover-tip-height)
              ) / 2)
      )
    );
  }
  .spectrum--large .rubus-Popover--centerRight.is-open {
    transform: translate(
      calc(var(--rubus-action-menu-button-width) + var(--spectrum-global-dimension-size-115) * 2),
      calc(
        -1 * ((
                var(--rubus-action-menu-popover-height) + var(--rubus-action-menu-button-height) +
                  var(--rubus-action-menu-popover-tip-height)
              ) / 1.9)
      )
    );
  }
  .spectrum--medium .rubus-Popover--centerRight .spectrum-Popover-tip {
    top: calc((var(--rubus-action-menu-popover-height) - var(--rubus-action-menu-popover-tip-height)) / 2);
    left: calc(-0.99 * var(--spectrum-global-dimension-size-200));
    transform: rotate(90deg);
  }
  .spectrum--large .rubus-Popover--centerRight .spectrum-Popover-tip {
    top: calc((var(--rubus-action-menu-popover-height) - var(--rubus-action-menu-popover-tip-height)) / 2);
    left: calc(-0.972 * var(--spectrum-global-dimension-size-200));
    transform: rotate(90deg);
  }
</style>

<div class="rubus-Popover-registering" />

<div
  class="spectrum-Popover rubus-Popover--{popverPosition == 'auto' ? popverPositionAuto : popverPosition}
    {isQuiet && variants === 'menu' ? `rubus-Popover-quiet--${popverPosition == 'auto' ? popverPositionAuto : popverPosition}` : ``}
    {$$restProps.class}"
  class:is-open={isOpen}
  class:spectrum-Popover--dialog={variants === 'dialog'}
  bind:this={popover}>
  {#if variants === 'menu'}
    <slot />
  {:else if variants === 'dialog'}
    <div class="spectrum-Dialog-header">
      <div class="spectrum-Dialog-title">{title}</div>
    </div>
    <div class="spectrum-Dialog-content">
      <slot />
    </div>
    <div class="spectrum-Popover-tip" bind:this={popoverTip} />
  {/if}
</div>
