<script>
  import { setContext, getContext, beforeUpdate } from "svelte";
  import { writable } from "svelte/store";
  import CalendarHader from "./CalendarHader.svelte";
  import CalendarBody from "./body/CalendarBody.svelte";
  import "./fix-date.js";

  /**
   * Set base date
   * @type { Date | dateString }[nowDate = new Date()]
   */
  export let nowDate = new Date();

  /**
   * internationalization
   * @type { string }[lang = "en"]
   */
  export let lang = "en";

  /**
   * Set view date
   * @type { Date | dateString }[viewDate = nowDate]
   */
  export let viewDate = nowDate;

  /**
   * Whether to display dates other than this month
   * @type { boolean }[showOutsideMonth = true]
   */
  export let showOutsideMonth = true;

  /**
   * Date selection mode
   * @type { "single" | "range" }[pickerMode = "single"]
   */
  export let pickerMode = "single";

  /**
   * List of dates that need to be disabled
   * @type { Array }[disabled = []]
   */
  export let disabled = [];

  /**
   * Selected date
   * @type { string ï½œ Array }[selected = []]
   */
  export let selected = [];

  /**
   * Focused date
   * @type {  Array }[focused = []]
   */
  export let focused = [];

  /**
   * Valid date range
   * @type { "any" | Array }[validRange = "any"]
   */
  export let validRange = "any";

  /**
   * Week name adopts pattern
   * @type { "weekShortAbbreviation" | "weekAbbreviation" | "weekFullName"}[weekNameMode = "weekShortAbbreviation"]
   */
  export let weekNameMode = "weekShortAbbreviation";

  /**
   * Month name adopts pattern
   * @type { "monthAbbreviation" | "monthFullName" }[monthNameMode = "monthFullName"]
   */
  export let monthNameMode = "monthFullName";

  const RubusCalendarData = writable({
    nowDate: [],
    viewDate: viewDate,
    action: "next",
    flag: false,
    view: "month",
    monthName: monthNameMode,
    weekName: weekNameMode,
    lang: lang,
    showOutsideMonth: showOutsideMonth,
    pickerMode: pickerMode,
    disabled: disabled,
    selected: selected,
    focused: focused,
    validRange: validRange,
  });

  setContext("RubusCalendarData", RubusCalendarData);
  let rubusCalendarConfig = getContext("RubusCalendarData");

  beforeUpdate(() => {
    $rubusCalendarConfig.nowDate = nowDate;
    selected = $rubusCalendarConfig.selected;
  });
</script>

<div class="spectrum-Calendar">
  <CalendarHader />
  <CalendarBody />
</div>
