<script>
  import CalendarBodyHead from "./CalendarBodyHead.svelte";
  import CalendarBodyWeek from "./CalendarBodyWeek.svelte";
  import CalendarBodyYear from "./CalendarBodyYear.svelte";
  import { getThisMonthData } from "../calendar.js";
  import { getContext } from "svelte";
  import { fly } from "svelte/transition";

  let rubusCalendarData = getContext("RubusCalendarData");

  $: monthData = getThisMonthData($rubusCalendarData.viewDate);
</script>

<style>
  :global(.spectrum--medium .spectrum-Calendar-body) {
    width: 280px;
    height: 280px;
  }
  :global(.spectrum--large .spectrum-Calendar-body) {
    width: 336px;
    height: 336px;
  }
  .spectrum-Calendar-body {
    position: relative;
    overflow: hidden;
  }
  .rubus-calendar-body {
    position: absolute;
    bottom: 0;
    left: 0;
  }
</style>

<div class="spectrum-Calendar-body" role="grid" tabindex="0" aria-readonly="true" aria-disabled="false">
  {#if $rubusCalendarData.view == 'month'}
    {#if $rubusCalendarData.flag}
      <table
        role="presentation"
        class="spectrum-Calendar-table rubus-calendar-body"
        in:fly|local={{ x: `${$rubusCalendarData.action == 'prev' ? -200 : 200}`, duration: 300 }}>
        <CalendarBodyHead />
        <tbody role="presentation">
          {#each monthData as item, i}
            <CalendarBodyWeek week={item} />
          {/each}
        </tbody>
      </table>
    {:else}
      <table
        role="presentation"
        class="spectrum-Calendar-table rubus-calendar-body"
        in:fly|local={{ x: `${$rubusCalendarData.action == 'next' ? 200 : -200}`, duration: 300 }}>
        <CalendarBodyHead />
        <tbody role="presentation">
          {#each monthData as item, i}
            <CalendarBodyWeek week={item} />
          {/each}
        </tbody>
      </table>
    {/if}
  {:else if $rubusCalendarData.view == 'year'}
    {#if $rubusCalendarData.flag}
      <table
        role="presentation"
        class="spectrum-Calendar-table rubus-calendar-body"
        in:fly={{ y: `${$rubusCalendarData.action == 'prev' ? -200 : 200}`, duration: 300 }}>
        <tbody role="presentation">
          <CalendarBodyYear dateDate={$rubusCalendarData.viewDate} />
        </tbody>
      </table>
    {:else}
      <table
        role="presentation"
        class="spectrum-Calendar-table rubus-calendar-body"
        in:fly={{ y: `${$rubusCalendarData.action == 'next' ? 200 : -200}`, duration: 300 }}>
        <tbody role="presentation">
          <CalendarBodyYear dateDate={$rubusCalendarData.viewDate} />
        </tbody>
      </table>
    {/if}
  {/if}
</div>
