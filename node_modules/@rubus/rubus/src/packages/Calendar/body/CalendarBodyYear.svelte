<script>
  import { getContext } from "svelte";
  import noun from "../i18n";

  export let dateDate = [];

  let rubusCalendar = getContext("RubusCalendarData");
  $: monthList = noun[$rubusCalendar.lang][$rubusCalendar.monthName];
  $: currentYear = new Date(dateDate).getFullYear() == new Date($rubusCalendar.nowDate).getFullYear();
  $: currentMonth = new Date(dateDate).getMonth();

  function pickMonth(i) {
    let d = new Date($rubusCalendar.viewDate);
    let ty = d.getFullYear();
    let td = d.getDate();
    $rubusCalendar.viewDate = `${ty}-${i + 1}-${td}`;
    $rubusCalendar.view = "month";
  }
</script>

<style>
  :global(.spectrum--medium) {
    --rubus-Calendar-month-width: 280px;
  }
  :global(.spectrum--large) {
    --rubus-Calendar-month-width: 336px;
  }
  .rubus-Calendar-month {
    height: calc(var(--rubus-Calendar-month-width) / 4.4);
    width: calc(var(--rubus-Calendar-month-width) / 3.2);
    margin: var(--spectrum-calendar-day-padding, 4px);
    border-radius: 4px;
    line-height: calc(
      var(--rubus-Calendar-month-width) / 4.4 - var(--spectrum-calendar-day-border-size-key-focus, 2px) * 2
    );
  }
  .spectrum-Calendar-date:before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    box-sizing: border-box;
    height: calc(var(--rubus-Calendar-month-width) / 4.4);
    width: calc(var(--rubus-Calendar-month-width) / 3);
    border-radius: 4px;
    border: var(--spectrum-calendar-day-border-size-key-focus, 2px) solid transparent;
  }
  .spectrum-Calendar-tableCell {
    text-align: center;
    padding: 0;
    position: relative;
    box-sizing: content-box;
    height: calc(var(--rubus-Calendar-month-width) / 4.4);
    width: calc(var(--rubus-Calendar-month-width) / 3);
    padding: var(--spectrum-calendar-day-padding, 4px);
  }
  .current-month {
    color: var(--spectrum-calendar-day-today-text-color, var(--spectrum-global-color-gray-800));
    border-color: var(--spectrum-calendar-day-today-border-color, var(--spectrum-global-color-gray-800));
  }
</style>

<tr role="row">
  {#each monthList as item, i}
    {#if i < 3}
      <td role="gridcell" class="spectrum-Calendar-tableCell" on:click={() => pickMonth(i)}>
        <span
          role="presentation"
          class="spectrum-Calendar-date rubus-Calendar-month"
          class:current-month={currentMonth == i && currentYear}>{item}</span>
      </td>
    {/if}
  {/each}
</tr>

<tr role="row">
  {#each monthList as item, i}
    {#if i >= 3 && i < 6}
      <td role="gridcell" class="spectrum-Calendar-tableCell" on:click={() => pickMonth(i)}>
        <span
          role="presentation"
          class="spectrum-Calendar-date rubus-Calendar-month"
          class:current-month={currentMonth == i && currentYear}>{item}</span>
      </td>
    {/if}
  {/each}
</tr>
<tr role="row">
  {#each monthList as item, i}
    {#if i >= 6 && i < 9}
      <td role="gridcell" class="spectrum-Calendar-tableCell" on:click={() => pickMonth(i)}>
        <span
          role="presentation"
          class="spectrum-Calendar-date rubus-Calendar-month"
          class:current-month={currentMonth == i && currentYear}>{item}</span>
      </td>
    {/if}
  {/each}
</tr>
<tr role="row">
  {#each monthList as item, i}
    {#if i >= 9 && i < 12}
      <td role="gridcell" class="spectrum-Calendar-tableCell" on:click={() => pickMonth(i)}>
        <span
          role="presentation"
          class="spectrum-Calendar-date rubus-Calendar-month"
          class:current-month={currentMonth == i && currentYear}>{item}</span>
      </td>
    {/if}
  {/each}
</tr>
