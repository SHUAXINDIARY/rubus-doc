<script>
  import { onMount } from "svelte";
  import { current_component } from "svelte/internal";
  import { getEventsAction } from "../utils/get-events-action.js";
  import { IconCheckmarkMedium, IconAlertMedium } from "@rubus/svelte-spectrum-icons-ui";

  /**
   * The element's unique identifier.
   * @type { string }[id = `textarea-${Math.round(Math.random() * (99999 - 0)) + 0}`]
   */
  export let id = `textarea-${Math.round(Math.random() * (99999 - 0)) + 0}`;

  /**
   * Temporary text that occupies the text input when it is empty.
   * @type { string }[placeholder = ""]
   */
  export let placeholder = "";

  /**
   * The name of the input element, used when submitting an HTML form.
   * @type { string }[name = "field"]
   */
  export let name = "field";

  /**
   * The name of the input element, used when submitting an HTML form.
   * @type { string }[name = "field"]
   */
  export let value = "";

  /**
   * Set to `true` to mark the field as required
   * @type {boolean} [required=false]
   */
  export let required = false;

  /**
   * Set to `true` to disable the input
   * @type {boolean} [disabled=false]
   */
  export let disabled = false;

  /**
   * Whether the textfield should be displayed with a quiet style.
   * @type {boolean} [isQuiet=false]
   */
  export let isQuiet = false;

  /**
   * Whether the input should display its "valid" visual styling.
   * @type {boolean} [isValid=false]
   */
  export let isValid = false;

  /**
   * Whether the input should display its "invalid" visual styling.
   * @type {boolean} [isInvalid=false]
   */
  export let isInvalid = false;

  /**
   * Whether the input should display its "focused" visual styling.
   * @type {boolean} [isFocused=false]
   */
  export let isFocused = false;

  /**
   * Whether the input should display its "keyboard focused" visual styling.
   * @type {boolean} [isFocused=false]
   */
  export let isKeyboardFocused = false;

  /**
   * The maximum number of characters supported by the input.
   * @type {number} [maxLength = 32]
   */
  export let maxLength = 32;

  /**
   * The minimum number of characters required by the input.
   * @type {number} [minLength = 0]
   */
  export let minLength = 0;

  const eventsListen = getEventsAction(current_component);
  let textareaEl;
  let inputEl;

  function setFocus(focused) {
    var focusClass = inputEl.classList.contains("focus-ring") ? "is-keyboardFocused" : "is-focused";
    if (focused) {
      textareaEl.classList.add(focusClass);
    } else {
      textareaEl.classList.remove("is-keyboardFocused");
      textareaEl.classList.remove("is-focused");
    }
  }
</script>

<style global>
  .spectrum-Textfield.spectrum-Textfield--multiline.spectrum-Textfield--quiet .spectrum-Textfield-validationIcon {
    top: calc(
      var(--spectrum-textfield-icon-frame) / 2 -
        var(--spectrum-icon-alert-medium-height, var(--spectrum-global-dimension-size-225)) / 2
    );
  }
</style>

<div
  on:focusin={() => {
    setFocus(true);
  }}
  on:focusout={() => {
    setFocus(false);
  }}
  bind:this={textareaEl}
  class="spectrum-Textfield spectrum-Textfield--multiline"
  class:spectrum-Textfield--quiet={isQuiet}
  class:is-valid={isValid}
  class:is-invalid={isInvalid}
  class:is-focused={isFocused}
  class:is-keyboardFocused={isKeyboardFocused}
  class:is-disabled={disabled}>
  {#if isValid}
    <IconCheckmarkMedium className=" spectrum-Textfield-validationIcon" focusable="false" aria-hidden="true" />
  {/if}
  {#if isInvalid}
    <IconAlertMedium className=" spectrum-Textfield-validationIcon" focusable="false" aria-hidden="true" />
  {/if}
  <textarea
    {id}
    class="spectrum-Textfield-input"
    {placeholder}
    {name}
    bind:value
    {required}
    {disabled}
    bind:this={inputEl}
    maxlength={maxLength}
    minlength={minLength}
    use:eventsListen />
</div>
