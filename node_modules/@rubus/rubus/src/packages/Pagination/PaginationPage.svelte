<script>
  import Button from "../Button";
  import { afterUpdate } from "svelte";

  /**
   * Set the current  pagination number
   * @type {number}[currentPageNumber = 1]
   */
  export let currentPageNumber = 1;

  /**
   * Set the total number of pagination
   * @type {number}[totalPageNumber = 3]
   */
  export let totalPageNumber = 3;

  /**
   *Set up to display a few items
   * @type {number}[showPaginationNumber = 8]
   */
  export let showPaginationNumber = 8;

  let showPaginationStart = 1;
  let paginationArr = [];

  afterUpdate(() => {
    getCurrentPagination();
  });

  function getCurrentPagination() {
    if (totalPageNumber <= showPaginationNumber) {
      paginationArr.length = totalPageNumber;
      for (let index = 0; index < paginationArr.length; index++) {
        paginationArr[index] = index + 1;
      }
    } else {
      paginationArr.length = showPaginationNumber;
      if (currentPageNumber !== 1 && currentPageNumber - showPaginationStart >= showPaginationNumber - 3) {
        showPaginationStart = currentPageNumber - 1;
      }
      if (currentPageNumber - showPaginationStart === showPaginationNumber - 2) {
        showPaginationStart = currentPageNumber - 1;
      }
      if (currentPageNumber - showPaginationStart < 0 && currentPageNumber != 2) {
        showPaginationStart = showPaginationStart - showPaginationNumber + 2;
      }
      if (showPaginationStart < 1) {
        showPaginationStart = 1;
      }
      if (currentPageNumber + (showPaginationNumber - 3) >= totalPageNumber) {
        showPaginationStart = totalPageNumber - showPaginationNumber;
      }

      if (currentPageNumber + (showPaginationNumber - 3) < totalPageNumber) {
        for (let index = 0; index < paginationArr.length; index++) {
          if (index + 1 == showPaginationNumber) {
            paginationArr[index] = totalPageNumber;
          } else if (index + 1 == showPaginationNumber - 1) {
            paginationArr[index] = 0;
          } else {
            paginationArr[index] = showPaginationStart + index;
          }
        }
      } else {
        for (let index = 0; index < paginationArr.length; index++) {
          if (index === 0) {
            paginationArr[index] = 1;
          } else if (index == 1) {
            paginationArr[index] = 0;
          } else {
            paginationArr[index] = showPaginationStart + index + 1;
          }
        }
      }
    }
  }
</script>

<nav class="spectrum-Pagination spectrum-Pagination--listing" on:click on:keydown>
  <slot name="pagination-prev" />
  {#each paginationArr as item}
    {#if item}
      <Button
        exterior="action"
        isQuiet
        isSelected={item === currentPageNumber}
        on:click={() => {
          currentPageNumber = item;
        }}>
        {item}
      </Button>
    {:else}
      <Button exterior="action" isQuiet isSelected={item === currentPageNumber}>...</Button>
    {/if}
  {/each}
  <slot name="pagination-next" />
</nav>
<slot />
