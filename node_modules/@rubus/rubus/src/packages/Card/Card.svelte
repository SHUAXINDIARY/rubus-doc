<script>
  import { onMount } from "svelte";
  import { advanceAddClassName } from "../utils/presetStyle.js";
  import Image from "../Asset/Image.svelte";
  import Checkbox from "../Checkbox";

  /**
   * Set the alt attribute of the foreground img
   * @type {string} [coverPhotoAlt = "Cover photo"]
   */
  export let coverPhotoAlt = "Cover photo";

  /**
   * Set the src attribute of the foreground img
   * @type {string} [coverPhotoUrl = ""]
   */
  export let coverPhotoUrl = "";

  /**
   * Specify the orientation index for the card
   * @type {"horizontal" | "vertical"}  [orientation = "vertical"]
   */
  export let orientation = "vertical";

  /**
   * Is it selected
   * @type {boolean } [isSelected = false]
   */
  export let isSelected = false;

  /**
   * Set to `true` to disable the card checkbox
   * @type {boolean}[ disabled=false ]
   */
  export let disabled = false;

  /**
   * Set to `true` to focused the action
   * @type {boolean}[ isFocused=false ]
   */
  export let isFocused = false;

  /**
   * Specify the quiet mode of card
   * @type { boolean } [isQuiet= false]
   */
  export let isQuiet = false;

  /**
   * Specify the small mode of card
   * @type { boolean } [isSmall= false]
   */
  export let isSmall = false;

  /**
   * Specify the main title of card
   * @type { string } [title= ""]
   */
  export let title = "";

  /**
   * Specify the subtitle of card
   * @type { string } [subtitle= ""]
   */
  export let subtitle = "";

  /**
   * Specify the width of card
   * @type { string } [width= ""]
   */
  export let width = "";

  /**
   * Specify the height of card
   * @type { string } [height= ""]
   */
  export let height = "";

  /**
   * Specify the description of card
   * @type { string } [description= ""]
   */
  export let description = "";

  let card;
  onMount(() => {
    card && advanceAddClassName(card, "card-preview", "spectrum-Card-preview");
  });
  $: styleCss = [
    width && `width:var(--spectrum-global-dimension-${width});`,
    height && `height:var(--spectrum-global-dimension-${height});`,
  ]
    .filter(Boolean)
    .join(" ");
</script>

<style global>
  .spectrum-Card-quickActions {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .spectrum-Card:hover .spectrum-Card-quickActions,
  .spectrum-Card-actions {
    transition: background-color var(--spectrum-global-animation-duration-100, 130ms);
    border-radius: var(--spectrum-quickactions-border-radius, var(--spectrum-alias-border-radius-regular));
    background-color: var(
      --spectrum-quickactions-background-color,
      var(--spectrum-alias-background-color-quickactions)
    );
  }
  .is-focused .spectrum-Card-quickActions {
    transition: background-color var(--spectrum-global-animation-duration-100, 130ms);
    border-radius: var(--spectrum-quickactions-border-radius, var(--spectrum-alias-border-radius-regular));
    background-color: var(
      --spectrum-quickactions-background-color,
      var(--spectrum-alias-background-color-quickactions)
    );
  }
  .rubus-Checkbox {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    width: var(--spectrum-global-dimension-size-175);
  }
  .spectrum-Card-actions {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    width: var(--spectrum-quickactions-height, var(--spectrum-global-dimension-size-500));
  }
</style>

<div style={styleCss}>
  <div
    style={styleCss}
    class="spectrum-Card"
    class:spectrum-Card--quiet={isQuiet}
    class:spectrum-Card--small={isSmall}
    class:spectrum-Card--horizontal={orientation == 'horizontal'}
    class:is-focused={isFocused}
    tabindex="0"
    role="figure"
    bind:this={card}>
    {#if coverPhotoUrl}
      <Image class="spectrum-Card-coverPhoto" variants="background" imgAlt={coverPhotoAlt} imgUrl={coverPhotoUrl} />
    {:else}
      <slot name="card-preview" />
    {/if}
    <div class="spectrum-Card-body">
      <div class="spectrum-Card-header">
        <div class="spectrum-Card-title">{title}</div>
        {#if !isQuiet || !isSmall}
          <div class="spectrum-Card-actionButton">
            <slot name="card-action" />
          </div>
        {/if}
      </div>
      <div class="spectrum-Card-content">
        <div class="spectrum-Card-subtitle">{subtitle}</div>
        {#if description}
          <div class="spectrum-Card-description">{description}</div>
        {/if}
      </div>
    </div>
    {#if !isQuiet}
      <div class="spectrum-Card-footer">
        <slot />
      </div>
    {/if}
    {#if orientation == 'vertical'}
      {#if isQuiet && isSmall}
        <div class="spectrum-QuickActions spectrum-Card-actions">
          <slot name="card-action" />
        </div>
      {/if}
      <div class="spectrum-QuickActions spectrum-Card-quickActions">
        <div class="spectrum-Checkbox rubus-Checkbox">
          <Checkbox bind:checked={isSelected} {disabled} />
        </div>
      </div>
    {/if}
  </div>
</div>
