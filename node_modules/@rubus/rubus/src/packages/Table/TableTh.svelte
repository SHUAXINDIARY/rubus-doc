<script>
  import { getContext, onMount } from "svelte";
  import { IconArrowDownSmall, IconArrowUpSmall } from "@rubus/svelte-spectrum-icons-ui";
  import Checkbox from "../Checkbox";

  /**
   * Does the headCell support sorting
   * @type {boolean} [isSortable = false]
   */
  export let isSortable = false;

  /**
   *Whether to display the ascending and descending order Icon
   * @type {boolean} [showSortedIcon = false]
   */
  export let showSortedIcon = false;

  /**
   * The element tabindex attribute
   * @type {boolean|number} [tabindex = false]
   */
  export let tabindex = false;

  /**
   * The element aria-sort attribute
   * @type { "ascending" | "descending" |"none"} [ariaSort = "none"]
   */
  export let ariaSort = "none";

  /**
   * Whether to provide check option
   * @type {boolean} [isCheckbox = false]
   */
  export let isCheckbox = false;

  /**
   * Whether the row is checked
   * @type {boolean} [checked = false]
   */
  export let checked = false;

  let rubusTableStaticConfig = getContext("rubusTableStaticConfig");
  onMount(() => {
    if (!tabindex && !$rubusTableStaticConfig.multiSelect) {
      tabindex = 0;
    }
    if (showSortedIcon && ariaSort === "none") {
      ariaSort = "ascending";
    }
  });
</script>

{#if $rubusTableStaticConfig.useDivElement}
  <div
    class="spectrum-Table-headCell"
    class:spectrum-Table-checkboxCell={$rubusTableStaticConfig.multiSelect}
    class:is-sortable={isSortable}
    class:is-sorted-desc={showSortedIcon}
    aria-sort={ariaSort}
    {tabindex}
    style="flex: 1"
    role="columnheader"
    on:click
    on:keydown>
    {#if isCheckbox}
      <Checkbox class="spectrum-Table-checkbox" bind:checked isQuiet />
    {:else}
      <slot />
      {#if ariaSort === 'ascending'}
        <IconArrowDownSmall className="spectrum-Table-sortedIcon" focusable="false" aria-hidden="true" />
      {:else if ariaSort === 'descending'}
        <IconArrowUpSmall className="spectrum-Table-sortedIcon" focusable="false" aria-hidden="true" />
      {/if}
    {/if}
  </div>
{:else}
  <th
    class="spectrum-Table-headCell"
    class:spectrum-Table-checkboxCell={$rubusTableStaticConfig.multiSelect}
    class:is-sortable={isSortable}
    class:is-sorted-desc={showSortedIcon}
    aria-sort={ariaSort}
    {tabindex}
    on:click
    on:keydown>
    {#if isCheckbox}
      <Checkbox class="spectrum-Table-checkbox" bind:checked isQuiet />
    {:else}
      <slot />
      {#if ariaSort === 'ascending'}
        <IconArrowDownSmall className="spectrum-Table-sortedIcon" focusable="false" aria-hidden="true" />
      {:else if ariaSort === 'descending'}
        <IconArrowUpSmall className="spectrum-Table-sortedIcon" focusable="false" aria-hidden="true" />
      {/if}
    {/if}
  </th>
{/if}
