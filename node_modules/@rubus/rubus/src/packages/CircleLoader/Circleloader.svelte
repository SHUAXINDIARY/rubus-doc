<script>
  import { onMount } from "svelte";

  /**
   * Specify the scale of circle loader
   * @type {"medium" | "small" | "large"} [scale ="medium"]
   */
  export let scale = "medium";

  /**
   * Specify the variants of circle loader
   * @type {"general" | "overBackground"} [variants ="general"]
   */
  export let variants = "general";

  /**
   * Set an indeterminate status for the circle loader
   * @type {boolean} [indeterminate = false]
   */
  export let indeterminate = false;

  onMount(() => {
    animateCircleLoaders();
  });
  function animateCircleLoaders() {
    var value = 0;
    setInterval(function () {
      var loaders = document.querySelectorAll(".spectrum-CircleLoader:not(spectrum-CircleLoader--indeterminate)");
      if (loaders.length) {
        changeLoaders(loaders, value++);
        if (value >= 100) {
          value = 0;
        }
      }
    }, 500);
  }

  function changeLoaders(nodeList, value) {
    Array.prototype.slice.call(nodeList).forEach(function (loader) {
      changeLoader(loader, value);
    });
  }

  function changeLoader(loader, value, submask1, submask2) {
    submask1 = submask1 || loader.querySelector(".spectrum-CircleLoader-fillSubMask1");
    submask2 = submask2 || loader.querySelector(".spectrum-CircleLoader-fillSubMask2");
    var angle;
    if (value > 0 && value <= 50) {
      angle = -180 + (value / 50) * 180;
      submask1.style.transform = "rotate(" + angle + "deg)";
      submask2.style.transform = "rotate(-180deg)";
    } else if (value > 50) {
      angle = -180 + ((value - 50) / 50) * 180;
      submask1.style.transform = "rotate(0deg)";
      submask2.style.transform = "rotate(" + angle + "deg)";
    }
  }
</script>

<div
  class="spectrum-CircleLoader"
  class:spectrum-CircleLoader--indeterminate={indeterminate}
  class:spectrum-CircleLoader--small={scale == 'small'}
  class:spectrum-CircleLoader--large={scale == 'large'}
  class:spectrum-CircleLoader--overBackground={variants == 'overBackground'}>
  <div class="spectrum-CircleLoader-track" />
  <div class="spectrum-CircleLoader-fills">
    <div class="spectrum-CircleLoader-fillMask1">
      <div class="spectrum-CircleLoader-fillSubMask1">
        <div class="spectrum-CircleLoader-fill" />
      </div>
    </div>
    <div class="spectrum-CircleLoader-fillMask2">
      <div class="spectrum-CircleLoader-fillSubMask2">
        <div class="spectrum-CircleLoader-fill" />
      </div>
    </div>
  </div>
</div>
