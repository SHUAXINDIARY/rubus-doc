<script>
  import Button from "../Button";
  import TextField from "../TextField";
  import { IconCrossSmall } from "@rubus/svelte-spectrum-icons-ui";

  /**
   * The element's unique identifier.
   * @type { string }[id = `search-${Math.round(Math.random() * (99999 - 0)) + 0}`]
   */
  export let id = `searchwithin-${Math.round(Math.random() * (99999 - 0)) + 0}`;

  /**
   * Temporary text that occupies the text input when it is empty.
   * @type { string }[placeholder = "Search"]
   */
  export let placeholder = "Search";

  /**
   * The name of the input element, used when submitting an HTML form.
   * @type { string }[name = "search"]
   */
  export let name = "search";

  /**
   * The name of the input element, used when submitting an HTML form.
   * @type { string }[name = "field"]
   */
  export let value = "";

  /**
   * Set to `true` to disable the SearchWithin input
   * @type {boolean} [disabled=false]
   */
  export let disabled = false;

  /**
   * Used to specify the autocomplete attribute of the input element
   * @type { string }[autocomplete = "off"]
   */
  export let autocomplete = "off";

  let focused = false;
  $: showClearButton = (focused && value) || value;
</script>

<style global>
  .spectrum-SearchWithin-input::-webkit-search-cancel-button,
  .spectrum-SearchWithin-input::-webkit-search-decoration {
    -webkit-appearance: none;
  }
</style>

<form class="spectrum-SearchWithin" class:is-disabled={disabled} {id}>
  <slot />
  <TextField
    bind:value
    resetType="search"
    {placeholder}
    {name}
    {disabled}
    {autocomplete}
    on:focusin={() => {
      focused = true;
    }}
    on:focusout={() => {
      focused = false;
    }}
    on:focusin
    on:focusout
    on:input
    on:change
    on:keyup
    on:keydown
    inputClass="spectrum-SearchWithin-input" />

  {#if showClearButton}
    <Button type="reset" exterior="clear" class="spectrum-SearchWithin-clearButton" {disabled}>
      <IconCrossSmall className="spectrum-UIIcon-CrossSmall" focusable="false" aria-hidden="true" />
    </Button>
  {/if}
</form>
