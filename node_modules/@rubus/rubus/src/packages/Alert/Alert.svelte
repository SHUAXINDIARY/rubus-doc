<script>
  import { afterUpdate, onDestroy } from "svelte";
  import { IconInfoMedium, IconSuccessMedium, IconAlertMedium, IconHelpMedium } from "@rubus/svelte-spectrum-icons-ui";
  import ResizeObserver from "resize-observer-polyfill";
  import { throttle } from "throttle-debounce";

  /**
   * Specify the variant of alert
   * @type {"info"  | "success" | "warning" | "help" | "error"} [variant="info"]
   */
  export let variants = "info";

  /**
   * Specify the title of alert
   * @type {string} [title = "Alert title"]
   */
  export let title = "Alert title";

  /**
   * Specify the text content of alert
   * @type {string} [content = "This is a default text."]
   */
  export let content = "This is a default text.";

  /**
   * Specify the max-width css style of alert
   * @type {DimensionValue} [maxWidth = ""]
   */
  export let maxWidth = "";

  /**
   * Specify the min-width css style of alert
   * @type {DimensionValue} [minWidth = ""]
   */
  export let minWidth = "";

  /**
   * Specify the min-height css style of alert
   * @type {DimensionValue} [minHeight = ""]
   */
  export let minHeight = "";

  let alert;
  let iconSize = 18;
  const observer = new ResizeObserver(getIconScale);

  afterUpdate(() => {
    throttle(500, observer.observe(alert));
  });

  onDestroy(() => {
    observer.unobserve(alert);
  });
  function getIconScale() {
    iconSize = parseInt(
      getComputedStyle(document.documentElement).getPropertyValue("--spectrum-global-dimension-size-225")
    );
  }

  $: styleCssText = [
    maxWidth && `max-width:var(--spectrum-global-dimension-${maxWidth});`,
    minWidth && `min-width:var(--spectrum-global-dimension-${minWidth});`,
    minHeight && `min-height:var(--spectrum-global-dimension-${minWidth});`,
  ]
    .filter(Boolean)
    .join(" ");
</script>

<div class="spectrum-Alert spectrum-Alert--{variants}" bind:this={alert} style={styleCssText}>
  {#if variants == 'info'}
    <IconInfoMedium
      className="spectrum-Alert-icon"
      focusable="false"
      aria-hidden="true"
      width={iconSize}
      height={iconSize} />
  {:else if variants == 'success'}
    <IconSuccessMedium
      className="spectrum-Alert-icon"
      focusable="false"
      aria-hidden="true"
      width={iconSize}
      height={iconSize} />
  {:else if variants == 'warning'}
    <IconAlertMedium
      className="spectrum-Alert-icon"
      focusable="false"
      aria-hidden="true"
      width={iconSize}
      height={iconSize} />
  {:else if variants == 'help'}
    <IconHelpMedium
      className="spectrum-Alert-icon"
      focusable="false"
      aria-hidden="true"
      width={iconSize}
      height={iconSize} />
  {:else if variants == 'error'}
    <IconAlertMedium
      className="spectrum-Alert-icon"
      focusable="false"
      aria-hidden="true"
      width={iconSize}
      height={iconSize} />
  {/if}
  <div class="spectrum-Alert-header">
    <slot name="alert-header">{title}</slot>
  </div>
  <div class="spectrum-Alert-content">
    <slot name="alert-content">{content}</slot>
  </div>
  <div class="spectrum-Alert-footer">
    <slot />
  </div>
</div>
