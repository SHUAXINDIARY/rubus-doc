<script>
  /**
   * Specify the scale css variables of page
   * @type {"medium" | "large"} [spectrumScale="medium"]
   */
  export let spectrumScale = "medium";

  /**
   * Specify the theme css variables of page
   * @type {"dark" | "darkest" | "light" | "lightest"} [spectrumTheme="light"]
   */
  export let spectrumTheme = "dark";

  /**
   * Specify the reset css variables of page
   * @type {[{"--css-variable-name":"variable-value"}] | []} [resetCss= []]
   */
  export let resetCss = [];

  /**
   * Specify the reset css of page
   * @type {string} [resetCss= []]]
   */
  export let resetCssText = "";
  /**
   * Specify the theme color of mate element
   * If it is not set, the page theme color is automatically obtained
   * @type {string} [themeColor= undefined]]
   */
  export let themeColor = undefined;

  /**
   * Specify the language of page
   * @type {string:ISO 639-1} [language="en"]
   */
  export let language = "en";

  /**
   * Set the dir attribute for components to render correctly
   * ltr: left-to-right
   * rtl: right-to-left
   * @type {"ltr" | "rtl"} [languageReadingOrder="ltr"]
   */
  export let languageReadingOrder = "ltr";

  import { onMount, beforeUpdate, afterUpdate } from "svelte";

  let themeBgColor = "#cccccc";

  onMount(() => {
    setDocumentElementProperty();
    resetCssContent(resetCssText);
  });

  afterUpdate(() => {
    import("../utils/focus-ring-polyfill");
  });

  beforeUpdate(() => {
    setDocumentElementProperty();
    resetCssVariables(resetCss);
    getThemeBgColor();
  });

  function setDocumentElementProperty() {
    document.documentElement.className = `spectrum spectrum--${spectrumScale} spectrum--${spectrumTheme}`;
    document.documentElement.lang = language;
    document.documentElement.dir = languageReadingOrder;
  }

  function resetCssVariables(array) {
    if (!array) {
      return;
    }
    let cssVariablesName;
    for (let index = 0; index < array.length; index++) {
      cssVariablesName = Object.getOwnPropertyNames(array[index]);
      document.documentElement.style.setProperty(cssVariablesName, array[index][cssVariablesName]);
    }
  }
  function resetCssContent(contentText) {
    if (!contentText) {
      return;
    }
    var sheet = document.createElement("style");
    sheet.innerHTML = contentText;
    document.head.appendChild(sheet);
  }
  function getThemeBgColor() {
    themeBgColor = getComputedStyle(document.documentElement).getPropertyValue(
      "--spectrum-alias-background-color-default"
    );
  }
</script>

<svelte:head>
  <meta name="theme-color" content={themeColor || themeBgColor} />
</svelte:head>
<slot />
