<script>
  import { onMount } from "svelte";
  import Button from "../Button";

  /**
   * Specify the side of SplitButton
   * @type {"left" | "right" } [side = "left"]
   */
  export let side = "right";

  /**
   * Specify the label text of SplitButton
   * @type { string } [label = "Split Button"]
   */
  export let label = "Split Button";

  /**
   * Specify the variants  for the  SplitButton
   * @type {"cta" | "primary" | "secondary"}[variants = "cta"]
   */
  export let variants = "cta";

  /**
   * Set to `true` to disable the SplitButton
   * @type {boolean}[disabled=false]
   */
  export let disabled = false;

  let splitButtonEl;

  onMount(() => {
    advanceAddClassName(splitButtonEl, "splitbutton-trigger", "spectrum-SplitButton-icon", ".spectrum-Icon");
    switch (variants) {
      case "cta":
        advanceAddClassName(splitButtonEl, "splitbutton-trigger", "spectrum-SplitButton-trigger", ".spectrum-Button");
        break;
      case "primary":
        advanceAddClassName(
          splitButtonEl,
          "splitbutton-trigger",
          "spectrum-SplitButton-trigger",
          ".spectrum-Button",
          "spectrum-Button--cta"
        );
        advanceAddClassName(splitButtonEl, "splitbutton-trigger", "spectrum-Button--primary", ".spectrum-Button");
        break;
      case "secondary":
        advanceAddClassName(
          splitButtonEl,
          "splitbutton-trigger",
          "spectrum-SplitButton-trigger",
          ".spectrum-Button",
          "spectrum-Button--cta"
        );
        advanceAddClassName(splitButtonEl, "splitbutton-trigger", "spectrum-Button--secondary", ".spectrum-Button");
        break;
    }
  });

  function advanceAddClassName(el, slotName, className, isClassName, hasClassName) {
    let targetChild = el.children;
    if (targetChild) {
      for (let index = 0; index < targetChild.length; index++) {
        if (slotName && targetChild[index].slot && targetChild[index].slot == slotName) {
          if (isClassName) {
            let thisEl = targetChild[index].querySelectorAll(isClassName)[0];
            if (hasClassName && thisEl.classList.contains(hasClassName)) {
              thisEl.classList.remove(hasClassName);
            }
            thisEl.classList.add(className);
          } else {
            targetChild[index].classList.add(className);
          }
        }
      }
    }
  }
</script>

<div class="spectrum-SplitButton" class:spectrum-SplitButton--left={side === 'left'} bind:this={splitButtonEl}>
  {#if side === 'right'}
    <Button variant={variants} class="spectrum-SplitButton-action" {disabled} on:click on:keydown>
      <slot>{label}</slot>
    </Button>

    <slot name="splitbutton-trigger" />
  {:else}
    <slot name="splitbutton-trigger" />
    <Button variant={variants} class="spectrum-SplitButton-action" {disabled} on:click on:keydown>
      <slot>{label}</slot>
    </Button>
  {/if}
</div>
